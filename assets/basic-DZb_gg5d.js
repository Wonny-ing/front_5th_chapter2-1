import"./modulepreload-polyfill-B5Qt9EMX.js";const K=(t,e)=>`
    <div id="${t.id}" class="flex justify-between items-center mb-2">
      <span>${t.name} - ${t.price}원 x ${e}</span>
      <div>
        <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${t.id}" data-change="-1">-</button>
        <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${t.id}" data-change="1">+</button>
        <button class="remove-item bg-red-500 text-white px-2 py-1 rounded" data-product-id="${t.id}">삭제</button>
      </div>
    </div>
  `.replace(/\n\s*/g,""),x=(t,e=0,o=0)=>{let n=`<div id="cart-total" class="text-xl font-bold my-4">
    총액: ${Math.round(t)}원`;return e>0&&(n+=`<span class="text-green-500 ml-2">(${(e*100).toFixed(1)}% 할인 적용)</span>`),n+=`<span id="loyalty-points" class="text-blue-500 ml-2">(포인트: ${o})</span>`,n+="</div>",n.replace(/\n\s*/g,"")},_=t=>`<select id="product-select" class="border rounded p-2 mr-2">${t==null?void 0:t.map(o=>`<option value="${o.id}" ${o.quantity===0?"disabled":""}>${o.name} - ${o.price}원</option>`).join("")}</select>`,R=(t,e=5)=>{var n;return`<div id="stock-status" class="text-sm text-gray-500 mt-2">${(n=t==null?void 0:t.filter(c=>c.quantity<e))==null?void 0:n.map(c=>`${c.name}: ${c.quantity>0?`재고 부족 (${c.quantity}개 남음)`:"품절"}`).join(`
`)}</div>`},j=({products:t=[],totalAmount:e=0,discountRate:o=0,bonusPoints:n=0})=>`
    <div class="bg-gray-100 p-8">
      <div class="max-w-md mx-auto bg-white rounded-xrlwhsl shadow-md overflow-hidden md:max-w-2xl p-8">
        <h1 class="text-2xl font-bold mb-4">장바구니</h1>
        <div id="cart-items"></div>
        ${x(e,o,n)}
        ${_(t)}
        <button id="add-to-cart" class="bg-blue-500 text-white px-4 py-2 rounded">추가</button>
        ${R(t)}
      </div>
    </div>
  `.replace(/\n\s*/g,""),Y=(t,e=null)=>{let o={...t};const n=new Set,c=l=>{o={...o,...l},s()},s=()=>{n.forEach(l=>l(o))};return{getState:()=>({...o}),setState:c,subscribe:l=>(n.add(l),l(o),()=>{n.delete(l)}),dispatch:l=>{if(!e)return l;const u=e(o,l);return c(u),l}}},q="INITIALIZE_PRODUCTS",D="UPDATE_PRODUCT_STOCK",v="ADD_TO_CART",O="UPDATE_CART_ITEM",$="REMOVE_FROM_CART",M="SET_LAST_SELECTED",w="UPDATE_CART_TOTALS",L={products:[]},V=(t=L,e)=>{switch(e.type){case q:return{...t,products:e.payload};case D:const{productId:o,changeAmount:n}=e.payload;return{...t,products:t.products.map(c=>c.id===o?{...c,quantity:c.quantity-n}:c)};default:return t}},Z={p1:.1,p2:.15,p3:.2,p4:.05,p5:.25},P=.1,E=.25,W=30,G=1e3,J=[{id:"p1",name:"상품1",price:1e4,quantity:50},{id:"p2",name:"상품2",price:2e4,quantity:30},{id:"p3",name:"상품3",price:3e4,quantity:20},{id:"p4",name:"상품4",price:15e3,quantity:0},{id:"p5",name:"상품5",price:25e3,quantity:10}],U={cartItems:[],lastSelectedProduct:null,totalAmount:0,itemCount:0,discountRate:0,bonusPoints:0},X=(t=U,e)=>{switch(e.type){case v:{const{product:o,quantity:n}=e.payload,c=t.cartItems.findIndex(a=>a.productId===o.id);let s;return c>=0?s=t.cartItems.map((a,i)=>i===c?{...a,quantity:a.quantity+n}:a):s=[...t.cartItems,{productId:o.id,name:o.name,price:o.price,quantity:n}],{...t,cartItems:s}}case O:{const{productId:o,quantity:n}=e.payload;return n<=0?{...t,cartItems:t.cartItems.filter(c=>c.productId!==o)}:{...t,cartItems:t.cartItems.map(c=>c.productId===o?{...c,quantity:n}:c)}}case $:{const{productId:o}=e.payload;return{...t,cartItems:t.cartItems.filter(n=>n.productId!==o)}}case M:return{...t,lastSelectedProduct:e.payload.productId};case w:{const{products:o}=e.payload;let n=0,c=0,s=0;t.cartItems.forEach(r=>{if(!o.find(S=>S.id===r.productId))return;const u=r.price*r.quantity;let p=0;c+=r.quantity,s+=u,r.quantity>=10&&(p=Z[r.productId]||0),n+=u*(1-p)});let a=0;if(c>=W){const r=n*E,l=s-n;r>l?(n=s*(1-E),a=E):a=(s-n)/s||0}else a=(s-n)/s||0;new Date().getDay()===2&&(n*=1-P,a=Math.max(a,P));const i=Math.floor(n/G);return{...t,totalAmount:n,discountRate:a,bonusPoints:i,itemCount:c}}default:return t}},B={...L,...U},tt=(t=B,e)=>{const o=V({products:t.products},e),n=X({cartItems:t.cartItems,lastSelectedProduct:t.lastSelectedProduct,totalAmount:t.totalAmount,itemCount:t.itemCount,discountRate:t.discountRate,bonusPoints:t.bonusPoints},e);return{...o,...n}},d=Y(B,tt),h=(()=>{const t={},e=(s,a,i)=>{t[s]||(t[s]=[],document.addEventListener(s,n,!1)),t[s].push({selector:a,handler:i})},o=(s,a,i)=>{t[s]&&(i?t[s]=t[s].filter(r=>r.selector!==a||r.handler!==i):t[s]=t[s].filter(r=>r.selector!==a),t[s].length===0&&(document.removeEventListener(s,n,!1),delete t[s]))},n=s=>{const a=t[s.type];if(!a)return;let i=s.target;for(;i&&i!==document;){for(const{selector:r,handler:l}of a)i.matches(r)&&l.call(i,s);i=i.parentNode}};return{on:e,off:o,trigger:(s,a,i={})=>{const r=new CustomEvent(a,{bubbles:!0,cancelable:!0,detail:i});s.dispatchEvent(r)}}})(),m=(()=>{const t={};return{initialize:()=>(t.productSelectEl=document.getElementById("product-select"),t.addToCartButtonEl=document.getElementById("add-to-cart"),t.cartItemsEl=document.getElementById("cart-items"),t.cartTotalEl=document.getElementById("cart-total"),t.stockStatusEl=document.getElementById("stock-status"),t),get:s=>(t[s]||(t[s]=document.getElementById(s)),t[s]),getAll:()=>({...t}),set:(s,a)=>{t[s]=a}}})(),et=()=>({type:q,payload:J}),g=(t,e)=>({type:D,payload:{productId:t,changeAmount:e}}),nt=(t,e=1)=>({type:v,payload:{product:t,quantity:e}}),k=(t,e)=>({type:O,payload:{productId:t,quantity:e}}),H=t=>({type:$,payload:{productId:t}}),ot=t=>({type:M,payload:{productId:t}}),T=(t,e)=>({type:w,payload:{cartItems:t,products:e}}),I=t=>t.products,C=(t,e)=>t.products.find(o=>o.id===e)||null,N=(t,e)=>{const o=C(t,e);return o?o.quantity:0},A=t=>t.cartItems,st=t=>t.bonusPoints,ct=t=>t.lastSelectedProduct,b=(t,e)=>{t.innerHTML=e},f=(t,e,o,n=!1)=>{const c=K(e,o);if(n){const s=document.createElement("div");s.innerHTML=c;const a=s.firstElementChild;t.appendChild(a)}else{const s=document.getElementById(e.id);s&&(s.querySelector("span").textContent=`${e.name} - ${e.price}원 x ${o}`)}},Q=t=>{const e=document.getElementById(t);e&&e.remove()},at=(t,e,o,n)=>{b(t,x(e,o,n))},F=(t,e)=>{b(t,_(e))},z=F,rt=(t,e,o=5)=>{b(t,R(e,o))},dt=()=>{setTimeout(()=>{setInterval(()=>{const t=d.getState(),e=I(t),o=e[Math.floor(Math.random()*e.length)];if(Math.random()<.3&&o.quantity>0){o.price=Math.round(o.price*.8),alert("번개세일! "+o.name+"이(가) 20% 할인 중입니다!");const{sel:n}=m.getAll();z(n,e)}},3e4)},Math.random()*1e4)},it=()=>{setTimeout(()=>{setInterval(()=>{const t=d.getState(),e=ct(t);if(e){const o=I(t),n=o.find(c=>c.id!==e&&c.quantity>0);if(n){alert(n.name+"은(는) 어떠세요? 지금 구매하시면 5% 추가 할인!"),n.price=Math.round(n.price*.95);const{sel:c}=m.getAll();z(c,o)}}},6e4)},Math.random()*2e4)},lt=()=>{dt(),it()},ut=()=>{const t=document.getElementById("app"),e=d.getState();t.innerHTML=j(e),m.initialize()},y=()=>{const t=d.getState(),{productSelectEl:e,cartTotalEl:o,stockStatusEl:n}=m.getAll(),c=I(t),s=st(t);F(e,c),at(o,t.totalAmount,t.discountRate,s),rt(n,c)},pt=()=>{const t=d.getState(),{productSelectEl:e,cartItemsEl:o}=m.getAll(),n=e.value,c=C(t,n);if(c&&c.quantity>0){const s=document.getElementById(c.id);if(s){const l=parseInt(s.querySelector("span").textContent.split("x ")[1]),u=l+1,p=N(t,c.id)+l;u<=p?(d.dispatch(k(c.id,u)),d.dispatch(g(c.id,1)),f(o,c,u,!1)):alert("재고가 부족합니다.")}else d.dispatch(nt(c,1)),d.dispatch(g(c.id,1)),f(o,c,1,!0);d.dispatch(ot(n));const a=d.getState(),i=A(a),r=I(a);d.dispatch(T(i,r)),y()}},mt=t=>{const e=d.getState(),{cartItemsEl:o}=m.getAll(),n=t.target.dataset.productId,c=document.getElementById(n),s=C(e,n),a=parseInt(t.target.dataset.change),i=parseInt(c.querySelector("span").textContent.split("x ")[1]),r=i+a,l=N(e,n)+i;r>0&&r<=l?(d.dispatch(k(n,r)),d.dispatch(g(n,a)),f(o,s,r,!1)):r<=0?(d.dispatch(H(n)),d.dispatch(g(n,a)),Q(n)):alert("재고가 부족합니다.");const u=d.getState(),p=A(u),S=I(u);d.dispatch(T(p,S)),y()},It=t=>{const e=t.target.dataset.productId,o=document.getElementById(e),n=parseInt(o.querySelector("span").textContent.split("x ")[1]);d.dispatch(H(e)),d.dispatch(g(e,-n)),Q(e);const c=d.getState(),s=A(c),a=I(c);d.dispatch(T(s,a)),y()},gt=()=>{h.on("click","#add-to-cart",pt),h.on("click",".quantity-change",mt),h.on("click",".remove-item",It)},yt=()=>{d.dispatch(et()),ut(),gt(),lt(),d.subscribe(()=>{y()})};yt();
